import { Controller, Get, Post, Patch, Delete, Body, Param, UseGuards } from '@nestjs/common';
import { {{serviceClassName}} } from '{{serviceImportPath}}';
import { Create{{entity.name}}Dto } from '../dtos/create-{{lower entity.name}}.dto';
import { JwtAuthGuard } from '../../../auth/jwt.guard';
import { ScopesGuard } from '../../../auth/scopes.guard';
import { Scopes } from '../../../auth/scopes.decorator';

@Controller('{{service.route}}')
export class {{controllerClassName}} {
constructor(private readonly service: {{serviceClassName}}) {}

{{#if crud.create}}
@Post()
@UseGuards(JwtAuthGuard, ScopesGuard)
@Scopes({{#each crudScopes.create}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}})
async create(@Body() dto: Create{{entity.name}}Dto) {
return this.service.create(dto);
}
{{/if}}

{{#if crud.findAll}}
@Get()
@UseGuards(JwtAuthGuard, ScopesGuard)
@Scopes({{#each crudScopes.findAll}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}})
async findAll() {
return this.service.findAll();
}
{{/if}}

{{#if crud.findOne}}
@Get(':id')
@UseGuards(JwtAuthGuard, ScopesGuard)
@Scopes({{#each crudScopes.findOne}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}})
async findOne(@Param('id') id: string) {
return this.service.findOne(id);
}
{{/if}}

{{#if crud.update}}
@Patch(':id')
@UseGuards(JwtAuthGuard, ScopesGuard)
@Scopes({{#each crudScopes.update}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}})
async update(@Param('id') id: string, @Body() dto: any) {
return this.service.update(id, dto);
}
{{/if}}

{{#if crud.delete}}
@Delete(':id')
@UseGuards(JwtAuthGuard, ScopesGuard)
@Scopes({{#each crudScopes.delete}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}})
async delete(@Param('id') id: string) {
return this.service.delete(id);
}
{{/if}}

// Custom operations
{{#each operations}}
@{{nestjsMethod method}}('{{path}}')
{{#if authRequired}}
@UseGuards(JwtAuthGuard, ScopesGuard)
@Scopes({{#each effectiveScopes}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}})
{{/if}}
async {{name}}({{#if (eq method 'GET')}}{{else}}{{#if (eq method 'DELETE')}}{{else}}@Body() body: any{{/if}}{{/if}}) {
// TODO: Implement operation logic
return { message: 'Operation {{name}} executed' };
}
{{/each}}
}