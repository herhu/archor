import { Controller, Get, Post, Patch, Delete, Body, Param, UseGuards } from '@nestjs/common';
import { {{service.name}}Service } from '../services/{{service.name}}.service';
import { Create{{entity.name}}Dto } from '../dtos/create-{{lower entity.name}}.dto';
import { JwtAuthGuard } from '../../auth/jwt.guard';
import { ScopesGuard } from '../../auth/scopes.guard';
import { Scopes } from '../../auth/scopes.decorator';

@Controller('{{service.route}}')
export class {{controllerClassName}} {
constructor(private readonly service: {{service.name}}Service) {}

{{#if crud.create}}
@Post()
@UseGuards(JwtAuthGuard, ScopesGuard)
@Scopes('{{domainKey}}:write')
async create(@Body() dto: Create{{entity.name}}Dto) {
return this.service.create(dto);
}
{{/if}}

{{#if crud.findAll}}
@Get()
@UseGuards(JwtAuthGuard, ScopesGuard)
@Scopes('{{domainKey}}:read')
async findAll() {
return this.service.findAll();
}
{{/if}}

{{#if crud.findOne}}
@Get(':id')
@UseGuards(JwtAuthGuard, ScopesGuard)
@Scopes('{{domainKey}}:read')
async findOne(@Param('id') id: string) {
return this.service.findOne(id);
}
{{/if}}

{{#if crud.update}}
@Patch(':id')
@UseGuards(JwtAuthGuard, ScopesGuard)
@Scopes('{{domainKey}}:write')
async update(@Param('id') id: string, @Body() dto: any) {
return this.service.update(id, dto);
}
{{/if}}

{{#if crud.delete}}
@Delete(':id')
@UseGuards(JwtAuthGuard, ScopesGuard)
@Scopes('{{domainKey}}:write')
async delete(@Param('id') id: string) {
return this.service.delete(id);
}
{{/if}}

// Custom operations
{{#each operations}}
@{{nestjsMethod method}}('{{path}}')
{{#if authRequired}}
@UseGuards(JwtAuthGuard, ScopesGuard)
@Scopes({{#if authz.scopesAll}}{{#each authz.scopesAll}}'{{this}}'{{#unless @last}},
{{/unless}}{{/each}}{{else}}'{{../domainKey}}:{{#if (eq method 'GET')}}read{{else}}write{{/if}}'{{/if}})
{{/if}}
async {{name}}({{#if (eq method 'GET')}}{{else}}{{#if (eq method 'DELETE')}}{{else}}@Body() body: any{{/if}}{{/if}}) {
// TODO: Implement operation logic
return { message: 'Operation {{name}} executed' };
}
{{/each}}
}